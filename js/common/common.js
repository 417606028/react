"use strict";define(["jquery"],function($){return{ajax:function(url,options){var api=$TJ.appServer+url,self=this,params={url:api,cache:!1,type:"post",dataType:"json",contentType:"application/json",beforeSend:function(XMLHttpRequest){XMLHttpRequest.setRequestHeader("authentication",self.getCookie("authentication")),XMLHttpRequest.setRequestHeader("os-type",self.getCookie("os-type")),XMLHttpRequest.setRequestHeader("os-version",self.getCookie("os-version")),XMLHttpRequest.setRequestHeader("hospital",self.getCookie("hospital"))}};options=$.extend(params,options);var defer=$.Deferred();return $.ajax(options).done(function(res){return-1===+res.code?(self.tip({content:"系统异常！",duration:1e3}),!1):-4===+res.code?(self.tip({content:"您的版本过低，已经无法使用，请立即更新！",duration:1e3}),!1):-6===+res.code?(self.tip({content:"当前帐号在其他地方登录！",duration:1e3}),setTimeout(function(){APPJSBridge.firstPage()},1e3),!1):-2===+res.code?(self.tip({content:"登陆已过期，请重新登陆操作！",duration:1e3}),!1):0!==+res.code?(self.tip({content:"调用接口失败！",duration:1e3}),!1):void defer.resolve(res)}).fail(function(res){}),defer.promise()},scrollbar:function(){var agent=navigator.userAgent.toLowerCase();$TJ.scrolls?$TJ.scrolls.refresh():/iphone os/.test(agent)?$TJ.scrolls=new IScroll("#wrapper",{scrollX:!1,scrollY:!0,click:!0,scrollbars:!1,useTransform:!1,probeType:3,mouseWheel:!0,bindToWrapper:!0}):$TJ.scrolls=new IScroll("#wrapper",{scrollX:!1,scrollY:!0,click:!0,scrollbars:!1,useTransform:!0,useTransition:!1,probeType:3,mouseWheel:!0,bindToWrapper:!0})},formatDate:function(date,format){format=format||"yyyy-MM-dd hh:mm",$.isNumeric(date)||(date*=1),date=new Date(date);var o={"M+":date.getMonth()+1,"d+":date.getDate(),"h+":date.getHours(),"m+":date.getMinutes(),"s+":date.getSeconds(),"q+":Math.floor((date.getMonth()+3)/3),S:date.getMilliseconds()};/(y+)/.test(format)&&(format=format.replace(RegExp.$1,(date.getFullYear()+"").substr(4-RegExp.$1.length)));for(var k in o)new RegExp("("+k+")").test(format)&&(format=format.replace(RegExp.$1,1==RegExp.$1.length?o[k]:("00"+o[k]).substr((""+o[k]).length)));return format},getParams:function(url){var params=url.substring(url.lastIndexOf("?")+1),paramsObj={},sp=[];params.length>0&&(sp=params.split("&"));for(var i=0,_l=sp.length;_l>i;i++){var item=sp[i].split("=");paramsObj[item[0]]=item[1]}return paramsObj},alert:function(params){function removeAlert(){paramObj.callBack&&paramObj.callBack(),view.remove()}var paramObj={title:"提示框",sureBtn:"确定",content:"",callBack:""};"string"==typeof params?paramObj.content=params:paramObj=$.extend(paramObj,params);var html="<div class='my-dialog' id='my-dialog'><div class='alert-body'><div class='alert-title'>"+paramObj.title+"</div><div class='alert-content'><p>"+paramObj.content+"</p><div><input type='button' sid='sure' value='"+paramObj.sureBtn+"'></input></div></div></div></div>";$("body").append(html);var view=$("#my-dialog");view.find("[sid=sure]").on("click",removeAlert)},tip:function(params){$("#my-dialog-back")[0]&&($("#my-dialog").remove(),$("#my-dialog-back").remove());var paramObj={content:"",duration:1e3,callBack:""};"string"==typeof params?paramObj.content=params:paramObj=$.extend(paramObj,params);var html="<div class='my-dialog-tip' id='my-dialog-back'></div><div class='my-dialog-tip-container' id='my-dialog'><div class='tip-body'><p>"+paramObj.content+"</p></div></div>";$("body").append(html);var view=$("#my-dialog"),viewBack=$("#my-dialog-back");paramObj.duration&&setTimeout(function(){paramObj.callBack&&paramObj.callBack(),view.remove(),viewBack.remove()},paramObj.duration)},confirm:function(params){function sureClickEvent(){paramObj.sureCallBack&&paramObj.sureCallBack(),view.remove()}function cancelClickEvent(){paramObj.cancelCallBack&&paramObj.cancelCallBack(),view.remove()}var paramObj={title:"提示框",content:"",sureBtn:"确定",cancelBtn:"取消",sureCallBack:"",cancelCallBack:""};"string"==typeof params?paramObj.content=params:paramObj=$.extend(paramObj,params);var html="<div class='my-dialog' id='my-dialog'><div class='confirm-body'><div class='confirm-title'>"+paramObj.title+"</div><div class='confirm-content'><p>"+paramObj.content+"</p><div> <input type='button' sid='sure' value='"+paramObj.sureBtn+"'></input><input class='right' type='button' sid='cancel' value='"+paramObj.cancelBtn+"'></input></div></div></div></div>";$("body").append(html);var view=$("#my-dialog");view.find("[sid=sure]").on("click",sureClickEvent),view.find("[sid=cancel]").on("click",cancelClickEvent)},prompt:function(params){function sureClickEvent(){value=view.find("[sid=promptInput]").val(),paramObj.sureCallBack&&paramObj.sureCallBack(),view.remove()}function cancelClickEvent(){value=view.find("[sid=promptInput]").val(),paramObj.cancelCallBack&&paramObj.cancelCallBack(),view.remove()}var paramObj={title:"提示框",content:"",type:"text",placeholder:"",sureBtn:"确定",cancelBtn:"取消",sureCallBack:"",cancelCallBack:"",liukai:function(){alert()}};"string"==typeof params?paramObj.content=params:paramObj=$.extend(paramObj,params);var html="<div class='my-dialog' id='my-dialog'><div class='prompt-body'><div class='prompt-title'>"+paramObj.title+"</div><div class='prompt-content'><p>"+paramObj.content+"</p><input sid='promptInput' type='"+paramObj.type+"' class='input' placeholder='"+paramObj.placeholder+"'/><div><input class='btn' type='button' sid='sure' value='"+paramObj.sureBtn+"'></input><input class='btn right' type='button' sid='sure' value='"+paramObj.cancelBtn+"'></input></div></div></div></div>";$("body").append(html);var view=$("#my-dialog"),value="";view.find("[sid=sure]").on("click",sureClickEvent),view.find("[sid=cancel]").on("click",cancelClickEvent)},setCookie:function(cname,cvalue,exdays){var d=new Date;d.setTime(d.getTime()+24*exdays*60*60*1e3);var expires="expires="+d.toGMTString();document.cookie=cname+"="+cvalue+"; "+expires},getCookie:function(cname){if(document.cookie.length>0){var c_start=document.cookie.indexOf(cname+"=");if(-1!=c_start){c_start=c_start+cname.length+1;var c_end=document.cookie.indexOf(";",c_start);return-1==c_end&&(c_end=document.cookie.length),unescape(document.cookie.substring(c_start,c_end))}}return""},throttle:function(func,args){func.tId&&clearTimeout(func.tId),func.tId=setTimeout(function(){func.apply(this,args)},500)}}});