"use strict";define(["react","backbone","common","api","jsx!component/common/HeaderComponent.react"],function(React,Backbone,common,Api,HeaderComponent){return React.createClass({getInitialState:function(){return{items:[]}},listHandler:function(keywords,favoriteType){var me=this,pageNo=1,pageCount=1;Api.getCollectionList({keywords:keywords,favoriteType:favoriteType,pageNo:pageNo,pageSize:20}).then(function(res){0===+res.code&&(me.setState({items:keywords?res.itemList:me.state.items.concat(res.itemList)}),pageCount=res.pageCount,pageNo=res.pageNo,common.scrollbar())}),$TJ.scrolls.on("scrollEnd",function(){this.y<0&&pageCount>pageNo&&Api.getCollectionList({keywords:keywords,favoriteType:favoriteType,pageNo:pageNo,pageSize:20}).then(function(res){0===+res.code&&(me.setState({items:keywords?res.itemList:me.state.items.concat(res.itemList)}),pageCount=res.pageCount,pageNo=res.pageNo,common.scrollbar())})})},componentDidMount:function(){$("#content").removeClass("home-loading").removeClass("pt-page-moveToLeft").addClass("pt-page-moveFromLeft"),common.scrollbar(),this.listHandler("",common.getParams(location.href).favoriteType)},detail:function(item){$("#content").removeClass("pt-page-moveFromLeft").addClass("pt-page-moveToLeft");var rout=new Backbone.Router;setTimeout(function(){"1"===common.getParams(location.href).favoriteType?rout.navigate("rule/detail?id="+item.favoriteId+"&flag=1",{trigger:!0}):rout.navigate("dictionary/detail?id="+item.favoriteId+"&flag=1",{trigger:!0})},100)},discollect:function(item){var delindex=event.target.getAttribute("data-key"),me=this;return Api.removeCollection({favoriteId:item.favoriteId,favoriteType:common.getParams(location.href).favoriteType}).then(function(res){0===+res.code?(me.state.items.splice(delindex,1),me.setState({items:me.state.items}),common.tip({content:"取消收藏成功！",duration:1e3})):common.tip({content:"取消收藏失败！",duration:1e3})}),!1},doSearch:function(){var me=this;common.throttle(me.listHandler,[$.trim($("#search").val()),common.getParams(location.href).favoriteType])},render:function(){var header="",me=this;return $TJ.hasHeader&&(header=React.createElement(HeaderComponent,{back:!0,title:"规章制度"})),React.createElement("div",null,header,React.createElement("div",{className:$TJ.hasHeader?"hasHeader":""},React.createElement("div",{className:"search-title"},React.createElement("p",{className:"search"},React.createElement("input",{id:"search",type:"search",placeholder:"请输入搜索内容",onChange:this.doSearch}),React.createElement("i",{className:"ion-ios-search"}))),React.createElement("div",{className:"list rule-list"},this.state.items.length>0?this.state.items.map(function(item,i){return React.createElement("div",{className:"item top rule-detail",onClick:me.detail.bind(me,item)},item.favoriteName,React.createElement("i",{className:"icon-star",onClick:me.discollect.bind(me,item),"data-key":i}))},this):React.createElement("div",{className:"no-message"},"暂无收藏"))))}})});